---
title: "Contenedores"
linkTitle: "Contenedores"
weight: 5 
tags: [pentesting,contenedores]
description:  
---

## Introducción 
Los contenedores son procesos aislados que, por defecto, ¿se podrían considerar como seguros?. Su enfoque nos dice que sí pero existen muchos casos en los que, principalmente por malas configuraciones, podrían ser vulnerables.
## Aislados pero no herméticos - Posibles malas configuraciones
Tecnologías de contenedores como Docker, LXC, LXD, etc.. permiten a los usuarios lanzar un proceso aislado pero, existen multiples funcionalidades, que podrían comprometer la aplicación en mayor o menor medida:
// En este vídeo nos centraremos en explicar los casos más comunes de malas configuraciones

### Montaje de volúmenes
Esta funcionalidad permite montar un volumen en un contenedor. Un volumen puede ser una carpeta o archivo en el sistema de archivos del host o un filesystem aislado que cree docker junto con el contenedor. Los volúmenes se suelen utilizar para dar persistencia a los datos de un contenedor y así evitar cuando se para o se vuelve a desplegar un contenedor los datos ser pierdan.

Cuando montamos como volumen parte del host en un contenedor tenemos que tener en cuenta el usuario que ejecuta el engine de docker y el grupo de permisos y, por otra parte, el usuario que ejecuta el contenedor. Si montamos ficheros del hosts sensibles y los montamos en cualquier contenedor que ejecute el usuario root, este usuario sería capaz de acceder a los ficheros. Es importante que los contenedores no utilicen volúmenes sensibles, montar ficheros o directorios muy específicos y que los contenedores no utilicen el usuario root.

También se podría cambiar el usuario que ejecuta el engine de docker pero acarreo muchos problemas de funcionamiento a día de hoy y no lo recomiendo. Lo ideal es crear un usuario en el host y asignarle la propiedad de los archivos que queremos montar en el contenedor y, a su vez, ejecutar el contenedor con dicho usuario.

######TBD######


### Montaje del socket
Cuando utilizamos diferentes comandos de docker, como por ejemplo, docker run, lo que hace el cliente de docker es comunicarse con el engine mediante un socket. 

En algunos escenarios en los que se necesita ejecutar comandos de docker dentro de un contenedor, por ejemplo, un orquestador de servicios montado sobre docker que necesite levantar otros contenedores a su vez.

Si este orquestador, vamos a suponer que es un gitlab, esta a su vez expuesto públicamente por el hosts y es vulnerado, el atacante teniendo acceso al socket del docker engine (que recordemos que se ejecuta con el usuario root) podría escalar privilegios fácilmente.




### Ejecución de contenedores en modo privilegiado
##############

* Escalado a través del grupo de docker.
* Host vulnerable.
* Secretos o variables de entorno.


### Pivotar a otros contenedores de la red.
Docker por defecto crea una red donde ejecuta todos estos contenedores. Si no especificamos nada, todos los contenedores se ejecutan en la misma red. Esto puede permitir que se comprometa las seguridad de otros contenedores de la red.

Supongamos el escenario anterior:
![Jerarquía de servicios](/docs/pentesting/privilegios/example_env.drawio.svg)


## Herramientas
### Deepce
Esta herramienta permite enumerar y escalar privilegios en contenedores. Está escrita puramente en `sh` sin ninguna dependencia pero, para aprovechar todas las funcionalidades, usa herramientas como `curl`, `nmap`, `nslookup` y `dig` si estan disponibles.

Este es su repositorio de github:
https://github.com/stealthcopter/deepce


La descarga de la aplicación se puede hacer:
```shell
# Con wget
wget https://github.com/stealthcopter/deepce/raw/main/deepce.sh

# Con curl
curl -sL https://github.com/stealthcopter/deepce/raw/main/deepce.sh -o deepce.sh
```

EN PROCESO DE CONSTRUCCIÓN - PROXIMAMENTE